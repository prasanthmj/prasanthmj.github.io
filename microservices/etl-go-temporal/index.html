<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Building a Reliable ETL System with Go and Temporal: When Data Needs to Move Like a Marvel Superhero ü¶∏‚Äç‚ôÇÔ∏è </title><meta name="keywords" content="ETL, Go, SoftwareArchitecture, Golang, Temporal" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/css/styles.css" />
</head>
<body class="antialiased text-grey-900">
    
    <div class="container mx-auto max-w-screen-lg">
    <header class="flex items-center justify-between h-16 px-3 border-b border-gray-300">
    <div >
        <a href="/" class="flex items-center">
            <span class="text-lg text-gray-800 font-semibold">Prasanth Janardhanan</span>
        </a>
    </div>
    <div>
        <ul class="flex">
            <li class="t ml-5 text-md text-gray-700 hover:text-red-800"><a href="/" class="hover:underline">Articles</a></li>
            <li class="t ml-5 text-md text-gray-700 hover:text-red-800"><a href="/projects/" class="hover:underline">Projects</a></li>
            <li class="t ml-5 text-md text-gray-700 hover:text-red-800"><a href="/about/" class="hover:underline">About</a></li>
        </ul>
    </div>
</header>
    
    <article class="mt-6 mx-auto md:w-9/12 min-h-screen">
<h1 class="mt-5">Building a Reliable ETL System with Go and Temporal: When Data Needs to Move Like a Marvel Superhero ü¶∏‚Äç‚ôÇÔ∏è</h1>
<ul class="flex mb-2 list-none px-0 text-sm mt-0 ml-0 pt-0">
    
      <li class="pr-4 list-none">&#x1f3f7; <a href="/tags/etl" class="text-gray-600">ETL</a> </li>
    
      <li class="pr-4 list-none">&#x1f3f7; <a href="/tags/go" class="text-gray-600">Go</a> </li>
    
      <li class="pr-4 list-none">&#x1f3f7; <a href="/tags/softwarearchitecture" class="text-gray-600">SoftwareArchitecture</a> </li>
    
      <li class="pr-4 list-none">&#x1f3f7; <a href="/tags/golang" class="text-gray-600">Golang</a> </li>
    
      <li class="pr-4 list-none">&#x1f3f7; <a href="/tags/temporal" class="text-gray-600">Temporal</a> </li>
    
</ul>
  
<p>Ever tried moving your entire apartment through a drinking straw? That&rsquo;s basically what building ETL (Extract, Transform, Load) systems feels like sometimes. You&rsquo;ve got terabytes of data that need to go from Point A to Point B, transform from one shape to another along the way, and arrive without losing a single byte. Oh, and it needs to happen yesterday.</p>
<p>As a backend engineer who&rsquo;s battled these challenges at scale, I&rsquo;ve learned that building reliable ETL systems is less about writing perfect code (though that helps) and more about preparing for everything that could possibly go wrong. Because trust me, Murphy&rsquo;s Law isn&rsquo;t just a suggestion when it comes to data pipelines ‚Äì it&rsquo;s more like a promise.</p>
<p><img src="../images/etl-super-hero.webp" alt="ETL super hero"></p>
<h3 id="the-eternal-struggle-of-moving-data">The Eternal Struggle of Moving Data</h3>
<p>Picture this: You&rsquo;re moving houses. You&rsquo;ve got furniture that needs to be disassembled, packed, transported, and reassembled. Some items are fragile, others are oddly shaped, and that one IKEA shelf&hellip; well, nobody remembers how it went together in the first place. Now imagine doing this with millions of items, at light speed, while blindfolded. Welcome to the world of ETL!</p>
<p>The challenges are real:</p>
<ul>
<li>Data comes in all shapes and sizes (like that weirdly shaped vase your aunt gave you)</li>
<li>Some sources are slower than a sloth having a lazy day</li>
<li>Transformations can fail in more ways than there are Star Wars movies</li>
<li>And just when you think you&rsquo;re done, someone changes the destination schema</li>
</ul>
<h3 id="why-traditional-etl-systems-break-and-break-often">Why Traditional ETL Systems Break (and Break Often)</h3>
<p>Traditional ETL systems often follow the &ldquo;hope for the best&rdquo; architecture pattern. You know the one ‚Äì write a script, schedule it with cron, and pray to the data gods that nothing goes wrong. Spoiler alert: something always goes wrong.</p>
<p>Common failure points:</p>
<ul>
<li>Network hiccups that appear more often than plot holes in a time travel movie</li>
<li>Memory issues that make your system tap out faster than a rookie in a UFC fight</li>
<li>Transformation logic that suddenly breaks because someone upstream decided to &ldquo;improve&rdquo; their data format</li>
<li>State management that&rsquo;s about as reliable as a chocolate teapot</li>
</ul>
<h3 id="enter-go-and-temporal-our-dynamic-duo">Enter Go and Temporal: Our Dynamic Duo</h3>
<p>This is where our heroes enter the story. Like Batman and Robin (but with better error handling), Go and Temporal team up to tackle these challenges head-on.</p>
<p>Go brings to the table:</p>
<ul>
<li>Goroutines that handle concurrent operations like a juggler on espresso</li>
<li>Memory management that actually makes sense</li>
<li>Error handling that doesn&rsquo;t make you want to throw your laptop out the window</li>
</ul>
<p>Meanwhile, Temporal adds:</p>
<ul>
<li>Workflow management that persists like your grandmother&rsquo;s memory of that embarrassing thing you did when you were five</li>
<li>Retry logic that would make the Terminator proud (&ldquo;I&rsquo;ll be back&hellip; to process that failed record&rdquo;)</li>
<li>State management that survives everything short of an alien invasion</li>
</ul>
<p>Together, they form the backbone of a modern ETL system that doesn&rsquo;t just hope for the best ‚Äì it expects the worst and handles it gracefully. It&rsquo;s like having a self-healing, self-driving moving truck that can navigate through a hurricane while keeping your china intact.</p>
<h2 id="go-the-flash-of-backend-development">Go: The Flash of Backend Development</h2>
<p>Remember how The Flash can be in multiple places at once, processing information at superhuman speeds while making it look effortless? That&rsquo;s essentially what Go brings to our ETL system. Except instead of stopping supervillains, we&rsquo;re stopping data anomalies (which, let&rsquo;s be honest, can feel just as villainous at 3 AM when your pipeline breaks).</p>
<h3 id="why-go-is-perfect-for-etl-workloads">Why Go is Perfect for ETL Workloads</h3>
<p>Let&rsquo;s get real for a second ‚Äì ETL workloads are like those all-you-can-eat buffets where your eyes are bigger than your stomach. You need to process more data than you initially planned, faster than you expected, and with less resources than you hoped for. Go handles this like a champ for several reasons:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Instead of this nightmare
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>try {
</span></span><span style="display:flex;"><span>    <span style="color:#900;font-weight:bold">doSomething</span>()
</span></span><span style="display:flex;"><span>} <span style="color:#900;font-weight:bold">catch</span>(err1) {
</span></span><span style="display:flex;"><span>    try {
</span></span><span style="display:flex;"><span>        <span style="color:#900;font-weight:bold">handleError1</span>()
</span></span><span style="display:flex;"><span>    } <span style="color:#900;font-weight:bold">catch</span>(err2) {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Plot twist: Now we have two problems
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Go gives you this beauty
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">doSomething</span>(); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>    log.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;Failed with error: %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> err
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol>
<li>
<p><strong>Static Typing</strong>: Like having a very strict but loving parent, Go won&rsquo;t let you get away with type mismatches. When you&rsquo;re transforming millions of records, this is less of a safety net and more of a survival kit.</p>
</li>
<li>
<p><strong>Built-in Concurrency</strong>: Remember the old &ldquo;it&rsquo;s not rocket science&rdquo; saying? Well, Go&rsquo;s concurrency model actually IS rocket science, but they made it feel like building with LEGO blocks.</p>
</li>
<li>
<p><strong>Memory Management</strong>: Unlike that one roommate who never cleaned up after themselves, Go&rsquo;s garbage collector actually does its job, and does it well.</p>
</li>
</ol>
<h3 id="concurrent-processing-when-your-data-needs-to-be-everywhere-at-once">Concurrent Processing: When Your Data Needs to Be Everywhere at Once</h3>
<p><img src="../images/extracting-data.webp" alt="extracting data"></p>
<p>Here&rsquo;s where Go really shines brighter than Tony Stark&rsquo;s arc reactor. Let&rsquo;s look at a real-world example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ProcessBatch</span>(records []Record) {
</span></span><span style="display:flex;"><span>    resultChan <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">make</span>(<span style="color:#000;font-weight:bold">chan</span> Result, <span style="color:#0086b3">len</span>(records))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Launch processors like you&#39;re deploying the Avengers
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">for</span> _, record <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">range</span> records {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">go</span> <span style="color:#000;font-weight:bold">func</span>(r Record) {
</span></span><span style="display:flex;"><span>            resultChan <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">transformRecord</span>(r)
</span></span><span style="display:flex;"><span>        }(record)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Gather results like Thanos gathering infinity stones
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// (but for good, not for snapping half the universe away)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">:=</span> <span style="color:#099">0</span>; i &lt; <span style="color:#0086b3">len</span>(records); i<span style="color:#000;font-weight:bold">++</span> {
</span></span><span style="display:flex;"><span>        result <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">&lt;-</span>resultChan
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Handle each result as it comes in
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This isn&rsquo;t just code ‚Äì it&rsquo;s poetry in motion. Each record gets its own goroutine, running concurrently like a well-orchestrated flash mob. The beauty? You don&rsquo;t need a PhD in distributed systems to understand what&rsquo;s happening.</p>
<h3 id="error-handling-that-doesnt-make-you-want-to-quit-programming">Error Handling That Doesn&rsquo;t Make You Want to Quit Programming</h3>
<p>Let&rsquo;s talk about Go&rsquo;s error handling, which is like having a really honest friend ‚Äì sometimes brutally so, but you always know where you stand:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">type</span> ETLProcessor <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    source      Source
</span></span><span style="display:flex;"><span>    transformer Transformer
</span></span><span style="display:flex;"><span>    destination Destination
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>ETLProcessor) <span style="color:#900;font-weight:bold">ProcessRecord</span>(ctx context.Context, record Record) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Extract
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    data, err <span style="color:#000;font-weight:bold">:=</span> p.source.<span style="color:#900;font-weight:bold">Extract</span>(ctx, record)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;extraction failed: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Transform
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    transformed, err <span style="color:#000;font-weight:bold">:=</span> p.transformer.<span style="color:#900;font-weight:bold">Transform</span>(ctx, data)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;transformation failed: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Load
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> p.destination.<span style="color:#900;font-weight:bold">Load</span>(ctx, transformed); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;loading failed: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This explicit error handling might seem verbose if you&rsquo;re coming from other languages, but it&rsquo;s like having GPS navigation instead of someone in the passenger seat saying &ldquo;I think it was that turn back there&rdquo; ‚Äì you always know exactly where things went wrong.</p>
<h3 id="performance-that-makes-your-infrastructure-team-happy">Performance That Makes Your Infrastructure Team Happy</h3>
<p>Go&rsquo;s performance characteristics are like finding out your new car also makes espresso and gives massages ‚Äì it&rsquo;s full of pleasant surprises:</p>
<ul>
<li><strong>Low Memory Footprint</strong>: Your ETL jobs run lean, like a superhero who never skips cardio</li>
<li><strong>Fast Startup Time</strong>: Unlike Java applications that need to warm up like a diesel engine in winter, Go programs start faster than you can say &ldquo;ETL&rdquo;</li>
<li><strong>Efficient CPU Usage</strong>: Go utilizes your CPU cores like a master chef uses all their kitchen equipment ‚Äì nothing goes to waste</li>
</ul>
<p>Here&rsquo;s a quick example of how Go handles memory efficiently during batch processing:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ProcessLargeDataset</span>(reader <span style="color:#000;font-weight:bold">*</span>csv.Reader) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Stream records instead of loading everything into memory
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">for</span> {
</span></span><span style="display:flex;"><span>        record, err <span style="color:#000;font-weight:bold">:=</span> reader.<span style="color:#900;font-weight:bold">Read</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">==</span> io.EOF {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;read error: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Process each record independently
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">processRecord</span>(record); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            log.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#d14">&#34;Failed to process record: %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// Continue processing other records
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">continue</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This streaming approach means your ETL job can handle datasets bigger than your last AWS bill without breaking a sweat.</p>
<h2 id="temporal-the-time-stone-for-your-data-pipeline">Temporal: The Time Stone for Your Data Pipeline</h2>
<p>Remember how Doctor Strange used the Time Stone to control and manipulate time? That&rsquo;s basically what Temporal does for your ETL workflows ‚Äì minus the green glow and magical hand gestures. It&rsquo;s like having a DVR for your data processing: you can pause, rewind, and even fast-forward through failures.</p>
<h3 id="what-makes-temporal-special-hint-its-not-just-another-workflow-engine">What Makes Temporal Special (Hint: It&rsquo;s Not Just Another Workflow Engine)</h3>
<p>First, let&rsquo;s address the elephant in the room: Yes, there are many workflow engines out there. But Temporal is like the iPhone of workflow engines ‚Äì it wasn&rsquo;t the first, but it changed the game entirely. Here&rsquo;s a taste of what makes it special:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ETLWorkflow</span>(ctx workflow.Context, batchID <span style="color:#458;font-weight:bold">string</span>) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// This is not your grandmother&#39;s workflow engine
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    retryPolicy <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">&amp;</span>temporal.RetryPolicy{
</span></span><span style="display:flex;"><span>        InitialInterval:    time.Second,
</span></span><span style="display:flex;"><span>        BackoffCoefficient: <span style="color:#099">2.0</span>,
</span></span><span style="display:flex;"><span>        MaximumInterval:    time.Minute <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span>,
</span></span><span style="display:flex;"><span>        MaximumAttempts:    <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ctx = workflow.<span style="color:#900;font-weight:bold">WithActivityOptions</span>(ctx, workflow.ActivityOptions{
</span></span><span style="display:flex;"><span>        StartToCloseTimeout: time.Minute <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span>,
</span></span><span style="display:flex;"><span>        RetryPolicy:        retryPolicy,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">var</span> records []Record
</span></span><span style="display:flex;"><span>    err <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, ExtractRecords, batchID).<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">&amp;</span>records)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;extraction failed: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// More magic follows...
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="handling-failures-like-a-pro-the-try-try-again-approach-that-actually-works">Handling Failures Like a Pro: The &ldquo;Try-Try-Again&rdquo; Approach That Actually Works</h3>
<p>Remember Kenny from South Park? The kid who dies in every episode but always comes back? That&rsquo;s your ETL pipeline with Temporal ‚Äì except instead of dying, it gracefully handles failures and picks up right where it left off.</p>
<p>Here&rsquo;s how we handle those pesky transformation failures:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TransformationWorkflow</span>(ctx workflow.Context, records []Record) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    futures <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">make</span>([]workflow.Future, <span style="color:#0086b3">len</span>(records))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Launch transformations like you&#39;re ordering pizza for the Ninja Turtles
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Each one gets their own, and if one fails, the others keep going
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">for</span> i, record <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">range</span> records {
</span></span><span style="display:flex;"><span>        activityOptions <span style="color:#000;font-weight:bold">:=</span> workflow.ActivityOptions{
</span></span><span style="display:flex;"><span>            StartToCloseTimeout: time.Minute <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>            RetryPolicy: <span style="color:#000;font-weight:bold">&amp;</span>temporal.RetryPolicy{
</span></span><span style="display:flex;"><span>                InitialInterval:    time.Second,
</span></span><span style="display:flex;"><span>                BackoffCoefficient: <span style="color:#099">2.0</span>,
</span></span><span style="display:flex;"><span>                MaximumAttempts:    <span style="color:#099">3</span>,
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        ctx <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">WithActivityOptions</span>(ctx, activityOptions)
</span></span><span style="display:flex;"><span>        futures[i] = workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, TransformRecord, record)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Gather results like you&#39;re herding cats (but successfully)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    results <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">make</span>([]TransformedRecord, <span style="color:#0086b3">len</span>(records))
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i, future <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">range</span> futures {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> future.<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">&amp;</span>results[i]); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// Log but continue - we&#39;re resilient like that
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx).<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#d14">&#34;Transform failed&#34;</span>, <span style="color:#d14">&#34;error&#34;</span>, err)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">continue</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="state-management-that-survives-apocalypses-or-at-least-server-crashes">State Management That Survives Apocalypses (Or At Least Server Crashes)</h3>
<p>Remember that time you lost your game progress because you forgot to save? Temporal is like having auto-save on steroids. It remembers everything:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ETLActivity</span>(ctx context.Context, data Record) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Even if your entire data center goes up in flames,
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// Temporal remembers exactly where you were
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    progress <span style="color:#000;font-weight:bold">:=</span> activity.<span style="color:#900;font-weight:bold">GetInfo</span>(ctx).Attempt
</span></span><span style="display:flex;"><span>    logger <span style="color:#000;font-weight:bold">:=</span> activity.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    logger.<span style="color:#900;font-weight:bold">Info</span>(<span style="color:#d14">&#34;Processing attempt&#34;</span>, <span style="color:#d14">&#34;attempt&#34;</span>, progress)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Your processing logic here
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// If something fails, Temporal&#39;s got your back
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-power-of-temporal-workflows-its-like-time-travel-but-for-data">The Power of Temporal Workflows: It&rsquo;s Like Time Travel, But for Data</h3>
<p><img src="../images/wizards-lab.webp" alt="wizards lab"></p>
<p>Here&rsquo;s where things get really interesting. Temporal workflows are like a choose-your-own-adventure book where you can&rsquo;t lose:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">CompleteETLWorkflow</span>(ctx workflow.Context, config ETLConfig) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    logger <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Step 1: Extract (with superpowers)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">var</span> sourceData []Record
</span></span><span style="display:flex;"><span>    extractActivity <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, ExtractData, config.SourceConfig)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> extractActivity.<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">&amp;</span>sourceData); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#d14">&#34;Extraction failed&#34;</span>, <span style="color:#d14">&#34;error&#34;</span>, err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Step 2: Transform (with safety nets)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">var</span> transformedData []TransformedRecord
</span></span><span style="display:flex;"><span>    selector <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">NewSelector</span>(ctx)
</span></span><span style="display:flex;"><span>    batchSize <span style="color:#000;font-weight:bold">:=</span> <span style="color:#099">1000</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">:=</span> <span style="color:#099">0</span>; i &lt; <span style="color:#0086b3">len</span>(sourceData); i <span style="color:#000;font-weight:bold">+=</span> batchSize {
</span></span><span style="display:flex;"><span>        end <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">min</span>(i<span style="color:#000;font-weight:bold">+</span>batchSize, <span style="color:#0086b3">len</span>(sourceData))
</span></span><span style="display:flex;"><span>        batch <span style="color:#000;font-weight:bold">:=</span> sourceData[i:end]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        future <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, TransformBatch, batch)
</span></span><span style="display:flex;"><span>        selector.<span style="color:#900;font-weight:bold">AddFuture</span>(future, <span style="color:#000;font-weight:bold">func</span>(f workflow.Future) {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">var</span> result []TransformedRecord
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> f.<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">&amp;</span>result); err <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>                transformedData = <span style="color:#0086b3">append</span>(transformedData, result<span style="color:#000;font-weight:bold">...</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Step 3: Load (with confidence)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, LoadData, transformedData).<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">nil</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#0086b3">min</span>(a, b <span style="color:#458;font-weight:bold">int</span>) <span style="color:#458;font-weight:bold">int</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> a &lt; b {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> a
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> b
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="why-this-combo-is-like-peanut-butter-and-jelly-but-for-data-engineering">Why This Combo is Like Peanut Butter and Jelly (But for Data Engineering)</h3>
<p>The marriage of Go and Temporal is like finding out your favorite superhero and your favorite villain decided to team up ‚Äì unexpected but incredibly powerful:</p>
<ol>
<li><strong>Go&rsquo;s Concurrency + Temporal&rsquo;s Durability</strong>: Your ETL jobs run fast AND survive failures</li>
<li><strong>Type Safety + Workflow Versioning</strong>: Change your data structures without breaking existing workflows</li>
<li><strong>Error Handling + Retry Policies</strong>: Problems get solved before they become incidents</li>
</ol>
<h2 id="building-our-etl-pipeline-the-avengers-assemble">Building Our ETL Pipeline: The Avengers Assemble</h2>
<p>Just like Nick Fury brought together the Avengers, we&rsquo;re about to assemble all our components into a cohesive ETL system. And just like the Avengers, each piece has its own superpower but becomes even stronger as part of the team.</p>
<h3 id="system-architecture-putting-the-pieces-together">System Architecture: Putting the Pieces Together</h3>
<p>First, let&rsquo;s look at our system architecture. Think of it as the Avengers Tower ‚Äì it needs to be robust, scalable, and have a good coffee machine (okay, maybe not the last part).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Our core types that define the ETL pipeline
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">type</span> Pipeline <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    Config     PipelineConfig
</span></span><span style="display:flex;"><span>    Workflow   <span style="color:#000;font-weight:bold">*</span>temporal.Client
</span></span><span style="display:flex;"><span>    Metrics    MetricsClient
</span></span><span style="display:flex;"><span>    Logger     <span style="color:#000;font-weight:bold">*</span>zap.Logger
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">type</span> PipelineConfig <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    BatchSize      <span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>    Parallelism    <span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>    RetryAttempts  <span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>    Sources        []SourceConfig
</span></span><span style="display:flex;"><span>    Destinations   []DestConfig
</span></span><span style="display:flex;"><span>    ErrorHandling  ErrorHandlingConfig
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">type</span> ETLWorkflowState <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    CurrentBatch   <span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>    ProcessedCount <span style="color:#458;font-weight:bold">int64</span>
</span></span><span style="display:flex;"><span>    ErrorCount     <span style="color:#458;font-weight:bold">int64</span>
</span></span><span style="display:flex;"><span>    StartTime      time.Time
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Here&rsquo;s how we orchestrate all the moving parts:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewPipeline</span>(ctx context.Context, config PipelineConfig) (<span style="color:#000;font-weight:bold">*</span>Pipeline, <span style="color:#458;font-weight:bold">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Initialize Temporal client with some superhero-level configuration
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    tc, err <span style="color:#000;font-weight:bold">:=</span> temporal.<span style="color:#900;font-weight:bold">NewClient</span>(temporal.ClientOptions{
</span></span><span style="display:flex;"><span>        HostPort:  config.TemporalHostPort,
</span></span><span style="display:flex;"><span>        Namespace: config.TemporalNamespace,
</span></span><span style="display:flex;"><span>        Logger:    temporalLog.<span style="color:#900;font-weight:bold">NewZapAdapter</span>(logger),
</span></span><span style="display:flex;"><span>        ConnectionOptions: temporal.ConnectionOptions{
</span></span><span style="display:flex;"><span>            TLS:               tlsConfig,
</span></span><span style="display:flex;"><span>            MaxPayloadSize:    maxPayloadSize,
</span></span><span style="display:flex;"><span>            DisableKeepAlive: <span style="color:#000;font-weight:bold">false</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>, fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;failed to create Temporal client: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">&amp;</span>Pipeline{
</span></span><span style="display:flex;"><span>        Config:   config,
</span></span><span style="display:flex;"><span>        Workflow: tc,
</span></span><span style="display:flex;"><span>        Metrics:  <span style="color:#900;font-weight:bold">initMetrics</span>(),
</span></span><span style="display:flex;"><span>        Logger:   <span style="color:#900;font-weight:bold">initLogger</span>(),
</span></span><span style="display:flex;"><span>    }, <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="implementing-workflows-that-make-sense">Implementing Workflows That Make Sense</h3>
<p>Now, let&rsquo;s create workflows that are easier to understand than the plot of Inception:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">StartETLWorkflow</span>(ctx context.Context, request ETLRequest) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    workflowOptions <span style="color:#000;font-weight:bold">:=</span> temporal.WorkflowOptions{
</span></span><span style="display:flex;"><span>        ID:                 fmt.<span style="color:#900;font-weight:bold">Sprintf</span>(<span style="color:#d14">&#34;etl-%s-%s&#34;</span>, request.Source, uuid.<span style="color:#900;font-weight:bold">New</span>().<span style="color:#900;font-weight:bold">String</span>()),
</span></span><span style="display:flex;"><span>        TaskQueue:          <span style="color:#d14">&#34;etl-queue&#34;</span>,
</span></span><span style="display:flex;"><span>        WorkflowRunTimeout: <span style="color:#099">24</span> <span style="color:#000;font-weight:bold">*</span> time.Hour,
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Like a superhero&#39;s costume - can be replaced but maintains identity
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        WorkflowIDReusePolicy: temporal.WorkflowIDReusePolicyAllowDuplicate,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    run, err <span style="color:#000;font-weight:bold">:=</span> p.Workflow.<span style="color:#900;font-weight:bold">ExecuteWorkflow</span>(ctx, workflowOptions, p.ETLWorkflow, request)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;failed to start workflow: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Wait for completion or handle async
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">var</span> result ETLResult
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> run.<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">&amp;</span>result); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;workflow execution failed: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">ETLWorkflow</span>(ctx workflow.Context, request ETLRequest) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    logger <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx)
</span></span><span style="display:flex;"><span>    state <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">&amp;</span>ETLWorkflowState{
</span></span><span style="display:flex;"><span>        StartTime: workflow.<span style="color:#900;font-weight:bold">Now</span>(ctx),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Set up our activity options like we&#39;re preparing for battle
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    activityOptions <span style="color:#000;font-weight:bold">:=</span> workflow.ActivityOptions{
</span></span><span style="display:flex;"><span>        StartToCloseTimeout: <span style="color:#099">10</span> <span style="color:#000;font-weight:bold">*</span> time.Minute,
</span></span><span style="display:flex;"><span>        RetryPolicy: <span style="color:#000;font-weight:bold">&amp;</span>temporal.RetryPolicy{
</span></span><span style="display:flex;"><span>            InitialInterval:    time.Second,
</span></span><span style="display:flex;"><span>            BackoffCoefficient: <span style="color:#099">2.0</span>,
</span></span><span style="display:flex;"><span>            MaximumAttempts:    p.Config.RetryAttempts,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ctx = workflow.<span style="color:#900;font-weight:bold">WithActivityOptions</span>(ctx, activityOptions)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Extract phase
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">var</span> sourceData []Record
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, p.ExtractActivity, request.Source).<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">&amp;</span>sourceData); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#d14">&#34;Extraction failed&#34;</span>, <span style="color:#d14">&#34;error&#34;</span>, err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Transform phase with parallel processing
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    transformedData <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">make</span>([]TransformedRecord, <span style="color:#099">0</span>, <span style="color:#0086b3">len</span>(sourceData))
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">:=</span> <span style="color:#099">0</span>; i &lt; <span style="color:#0086b3">len</span>(sourceData); i <span style="color:#000;font-weight:bold">+=</span> p.Config.BatchSize {
</span></span><span style="display:flex;"><span>        end <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">min</span>(i<span style="color:#000;font-weight:bold">+</span>p.Config.BatchSize, <span style="color:#0086b3">len</span>(sourceData))
</span></span><span style="display:flex;"><span>        batch <span style="color:#000;font-weight:bold">:=</span> sourceData[i:end]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Process batch with child workflow for better isolation
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        childID <span style="color:#000;font-weight:bold">:=</span> fmt.<span style="color:#900;font-weight:bold">Sprintf</span>(<span style="color:#d14">&#34;%s-batch-%d&#34;</span>, workflow.<span style="color:#900;font-weight:bold">GetInfo</span>(ctx).WorkflowExecution.ID, i)
</span></span><span style="display:flex;"><span>        childWorkflowOptions <span style="color:#000;font-weight:bold">:=</span> workflow.ChildWorkflowOptions{
</span></span><span style="display:flex;"><span>            WorkflowID: childID,
</span></span><span style="display:flex;"><span>            TaskQueue:  <span style="color:#d14">&#34;transform-queue&#34;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        ctx <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">WithChildOptions</span>(ctx, childWorkflowOptions)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">var</span> batchResult []TransformedRecord
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">ExecuteChildWorkflow</span>(ctx, p.TransformBatchWorkflow, batch).<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">&amp;</span>batchResult); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#d14">&#34;Batch transform failed&#34;</span>, <span style="color:#d14">&#34;batch&#34;</span>, i, <span style="color:#d14">&#34;error&#34;</span>, err)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">continue</span> <span style="color:#998;font-style:italic">// Resilient processing - continue with next batch
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        transformedData = <span style="color:#0086b3">append</span>(transformedData, batchResult<span style="color:#000;font-weight:bold">...</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Load phase
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, p.LoadActivity, transformedData).<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">nil</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="monitoring-and-observability-because-flying-blind-is-for-pigeons">Monitoring and Observability: Because Flying Blind is for Pigeons</h3>
<p>Just like Iron Man has JARVIS, we need comprehensive monitoring. Here&rsquo;s how we set it up:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">type</span> MetricsClient <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Using DataDog, but could be any metrics provider
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    client <span style="color:#000;font-weight:bold">*</span>datadog.Client
</span></span><span style="display:flex;"><span>    tags   []<span style="color:#458;font-weight:bold">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">recordMetrics</span>(ctx context.Context, state <span style="color:#000;font-weight:bold">*</span>ETLWorkflowState) {
</span></span><span style="display:flex;"><span>    metrics <span style="color:#000;font-weight:bold">:=</span> []Metric{
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Name:  <span style="color:#d14">&#34;etl.records.processed&#34;</span>,
</span></span><span style="display:flex;"><span>            Value: state.ProcessedCount,
</span></span><span style="display:flex;"><span>            Tags:  []<span style="color:#458;font-weight:bold">string</span>{<span style="color:#d14">&#34;status:success&#34;</span>},
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Name:  <span style="color:#d14">&#34;etl.records.errors&#34;</span>,
</span></span><span style="display:flex;"><span>            Value: state.ErrorCount,
</span></span><span style="display:flex;"><span>            Tags:  []<span style="color:#458;font-weight:bold">string</span>{<span style="color:#d14">&#34;status:error&#34;</span>},
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            Name:  <span style="color:#d14">&#34;etl.duration_seconds&#34;</span>,
</span></span><span style="display:flex;"><span>            Value: time.<span style="color:#900;font-weight:bold">Since</span>(state.StartTime).<span style="color:#900;font-weight:bold">Seconds</span>(),
</span></span><span style="display:flex;"><span>            Tags:  []<span style="color:#458;font-weight:bold">string</span>{<span style="color:#d14">&#34;stage:complete&#34;</span>},
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> _, m <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">range</span> metrics {
</span></span><span style="display:flex;"><span>        p.Metrics.<span style="color:#900;font-weight:bold">Record</span>(ctx, m)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// Health check that actually tells you what&#39;s wrong
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">HealthCheck</span>(ctx context.Context) <span style="color:#000;font-weight:bold">*</span>Health {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">&amp;</span>Health{
</span></span><span style="display:flex;"><span>        TemporalConnection: p.<span style="color:#900;font-weight:bold">checkTemporalConnection</span>(ctx),
</span></span><span style="display:flex;"><span>        DataSourcesHealth:  p.<span style="color:#900;font-weight:bold">checkDataSources</span>(ctx),
</span></span><span style="display:flex;"><span>        SystemMetrics:      p.<span style="color:#900;font-weight:bold">getSystemMetrics</span>(ctx),
</span></span><span style="display:flex;"><span>        LastErrors:         p.<span style="color:#900;font-weight:bold">getRecentErrors</span>(ctx),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-secret-sauce-error-handling-and-recovery">The Secret Sauce: Error Handling and Recovery</h3>
<p>Like Doctor Strange&rsquo;s ability to turn back time, we need robust error handling:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">handleErrors</span>(ctx workflow.Context, err <span style="color:#458;font-weight:bold">error</span>, state <span style="color:#000;font-weight:bold">*</span>ETLWorkflowState) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    logger <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Categorize errors like a superhero categorizes villains
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">switch</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">case</span> errors.<span style="color:#900;font-weight:bold">Is</span>(err, ErrDataSource):
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Source system issues - maybe it&#39;s taking a coffee break
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">return</span> p.<span style="color:#900;font-weight:bold">handleSourceError</span>(ctx, err)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">case</span> errors.<span style="color:#900;font-weight:bold">Is</span>(err, ErrTransformation):
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Data transformation gone wrong - like a chemistry experiment gone bad
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">return</span> p.<span style="color:#900;font-weight:bold">handleTransformError</span>(ctx, err)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">case</span> errors.<span style="color:#900;font-weight:bold">Is</span>(err, ErrDestination):
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Destination system issues - maybe it&#39;s full
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">return</span> p.<span style="color:#900;font-weight:bold">handleDestinationError</span>(ctx, err)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">default</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Unknown error - the most dangerous kind
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        logger.<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#d14">&#34;Unknown error occurred&#34;</span>, <span style="color:#d14">&#34;error&#34;</span>, err)
</span></span><span style="display:flex;"><span>        state.ErrorCount<span style="color:#000;font-weight:bold">++</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> err
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="battle-tested-patterns-and-practices">Battle-Tested Patterns and Practices</h2>
<p>Remember how Tony Stark kept iterating on his Iron Man suits? That&rsquo;s exactly what we do with ETL patterns. Each production incident teaches us something new, and today I&rsquo;m sharing the patterns that emerged from those 3 AM production support calls.</p>
<h3 id="handling-retries-without-losing-your-sanity">Handling Retries Without Losing Your Sanity</h3>
<p>First, let&rsquo;s talk about the retry patterns that actually work in production:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// RetryableActivity wraps any activity with smart retry logic
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">RetryableActivity</span>(ctx workflow.Context, activity <span style="color:#000;font-weight:bold">interface</span>{}, params <span style="color:#000;font-weight:bold">interface</span>{}) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Configure retry policies based on activity type
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    retryPolicy <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">&amp;</span>temporal.RetryPolicy{
</span></span><span style="display:flex;"><span>        InitialInterval:        time.Second,
</span></span><span style="display:flex;"><span>        BackoffCoefficient:    <span style="color:#099">2.0</span>,
</span></span><span style="display:flex;"><span>        MaximumInterval:       time.Minute <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">10</span>,
</span></span><span style="display:flex;"><span>        MaximumAttempts:       <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>        NonRetryableErrorTypes: []<span style="color:#458;font-weight:bold">string</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;InvalidDataError&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;ValidationError&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;BusinessRuleError&#34;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    options <span style="color:#000;font-weight:bold">:=</span> workflow.ActivityOptions{
</span></span><span style="display:flex;"><span>        StartToCloseTimeout: time.Minute <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">30</span>,
</span></span><span style="display:flex;"><span>        RetryPolicy:        retryPolicy,
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// HeartbeatTimeout ensures we know if our activity is still alive
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        HeartbeatTimeout:    time.Minute <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ctx = workflow.<span style="color:#900;font-weight:bold">WithActivityOptions</span>(ctx, options)
</span></span><span style="display:flex;"><span>    future <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, activity, params)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> future.<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">nil</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="scaling-strategies-that-wont-break-the-bank">Scaling Strategies That Won&rsquo;t Break the Bank</h3>
<p>Like Ant-Man, our ETL system needs to be able to grow and shrink based on demand:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">type</span> ScalableProcessor <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    MaxConcurrent   <span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>    BatchSize       <span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>    WorkerPool     <span style="color:#000;font-weight:bold">*</span>WorkerPool
</span></span><span style="display:flex;"><span>    RateLimit      <span style="color:#000;font-weight:bold">*</span>rate.Limiter
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>ScalableProcessor) <span style="color:#900;font-weight:bold">ProcessBatch</span>(ctx context.Context, records []Record) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Use semaphore to control concurrent processing
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    sem <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">make</span>(<span style="color:#000;font-weight:bold">chan</span> <span style="color:#000;font-weight:bold">struct</span>{}, p.MaxConcurrent)
</span></span><span style="display:flex;"><span>    errChan <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">make</span>(<span style="color:#000;font-weight:bold">chan</span> <span style="color:#458;font-weight:bold">error</span>, <span style="color:#0086b3">len</span>(records))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">:=</span> <span style="color:#099">0</span>; i &lt; <span style="color:#0086b3">len</span>(records); i <span style="color:#000;font-weight:bold">+=</span> p.BatchSize {
</span></span><span style="display:flex;"><span>        end <span style="color:#000;font-weight:bold">:=</span> <span style="color:#0086b3">min</span>(i<span style="color:#000;font-weight:bold">+</span>p.BatchSize, <span style="color:#0086b3">len</span>(records))
</span></span><span style="display:flex;"><span>        batch <span style="color:#000;font-weight:bold">:=</span> records[i:end]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Wait for rate limiter
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> p.RateLimit.<span style="color:#900;font-weight:bold">Wait</span>(ctx); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;rate limit wait failed: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sem <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#000;font-weight:bold">struct</span>{}{} <span style="color:#998;font-style:italic">// Acquire semaphore
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">go</span> <span style="color:#000;font-weight:bold">func</span>(b []Record) {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">defer</span> <span style="color:#000;font-weight:bold">func</span>() { <span style="color:#000;font-weight:bold">&lt;-</span>sem }() <span style="color:#998;font-style:italic">// Release semaphore
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> p.<span style="color:#900;font-weight:bold">processSingleBatch</span>(ctx, b); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>                errChan <span style="color:#000;font-weight:bold">&lt;-</span> err
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }(batch)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Wait for all goroutines to complete
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> p.<span style="color:#900;font-weight:bold">waitForCompletion</span>(sem, errChan)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="data-validation-trust-no-one-verify-everything">Data Validation: Trust No One, Verify Everything</h3>
<p>Like Nick Fury&rsquo;s trust issues, our data validation needs to be thorough:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">type</span> Validator <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    Rules    []ValidationRule
</span></span><span style="display:flex;"><span>    Metrics  <span style="color:#000;font-weight:bold">*</span>MetricsClient
</span></span><span style="display:flex;"><span>    Logger   <span style="color:#000;font-weight:bold">*</span>zap.Logger
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (v <span style="color:#000;font-weight:bold">*</span>Validator) <span style="color:#900;font-weight:bold">ValidateRecord</span>(ctx context.Context, record Record) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Context-aware validation that adapts to data patterns
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    validationContext <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">&amp;</span>ValidationContext{
</span></span><span style="display:flex;"><span>        RecordType:  record.Type,
</span></span><span style="display:flex;"><span>        Timestamp:   time.<span style="color:#900;font-weight:bold">Now</span>(),
</span></span><span style="display:flex;"><span>        Historical:  <span style="color:#0086b3">make</span>(<span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#000;font-weight:bold">interface</span>{}),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> _, rule <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">range</span> v.Rules {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> rule.<span style="color:#900;font-weight:bold">Validate</span>(record, validationContext); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            v.Metrics.<span style="color:#900;font-weight:bold">IncCounter</span>(<span style="color:#d14">&#34;validation.failures&#34;</span>, 
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#458;font-weight:bold">string</span>{<span style="color:#d14">&#34;rule&#34;</span>: rule.<span style="color:#900;font-weight:bold">Name</span>()})
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;validation failed for rule %s: %w&#34;</span>, 
</span></span><span style="display:flex;"><span>                rule.<span style="color:#900;font-weight:bold">Name</span>(), err)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="real-world-war-stories">Real-World War Stories</h2>
<h3 id="that-time-when-processing-1-million-records-didnt-end-in-tears">That Time When Processing 1 Million Records Didn&rsquo;t End in Tears</h3>
<p>Let me tell you about a production incident that taught us more than a year of development. Picture this: It&rsquo;s 2 AM, and our ETL pipeline is processing a million-record batch that absolutely, positively has to be done by morning.</p>
<p>Here&rsquo;s what saved us:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">ProcessLargeDataset</span>(ctx context.Context, source Source) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Break down processing into manageable chunks
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">const</span> checkpointSize = <span style="color:#099">10000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">var</span> processed <span style="color:#458;font-weight:bold">int64</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Use Temporal&#39;s built-in checkpointing
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx).<span style="color:#900;font-weight:bold">Info</span>(<span style="color:#d14">&#34;Processing chunk&#34;</span>, 
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;processed&#34;</span>, processed)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">var</span> records []Record
</span></span><span style="display:flex;"><span>        err <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, 
</span></span><span style="display:flex;"><span>            p.FetchNextBatch, 
</span></span><span style="display:flex;"><span>            source, 
</span></span><span style="display:flex;"><span>            checkpointSize).<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">&amp;</span>records)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> errors.<span style="color:#900;font-weight:bold">Is</span>(err, ErrNoMoreData) {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> err
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Process each chunk with automatic retry
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> p.<span style="color:#900;font-weight:bold">processChunkWithRetry</span>(ctx, records); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// Log error but continue - we can fix failed records later
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx).<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#d14">&#34;Chunk processing failed&#34;</span>, 
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;error&#34;</span>, err)
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">continue</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Update progress for durability
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        processed <span style="color:#000;font-weight:bold">+=</span> <span style="color:#0086b3">int64</span>(<span style="color:#0086b3">len</span>(records))
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">UpsertSearchAttributes</span>(ctx, 
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">map</span>[<span style="color:#458;font-weight:bold">string</span>]<span style="color:#000;font-weight:bold">interface</span>{}{
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;CustomIntField&#34;</span>: processed,
</span></span><span style="display:flex;"><span>            }); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;failed to update progress: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="lessons-learned-from-production-deployments">Lessons Learned from Production Deployments</h3>
<ol>
<li><strong>Monitor Everything, Trust Nothing</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">monitorProgress</span>(ctx workflow.Context) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Set up continuous monitoring
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    heartbeat <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">NewTimer</span>(ctx, time.Minute)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">select</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">case</span> <span style="color:#000;font-weight:bold">&lt;-</span>heartbeat.<span style="color:#900;font-weight:bold">Chan</span>():
</span></span><span style="display:flex;"><span>            stats <span style="color:#000;font-weight:bold">:=</span> p.<span style="color:#900;font-weight:bold">gatherStats</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(ctx, 
</span></span><span style="display:flex;"><span>                p.ReportMetrics, stats).<span style="color:#900;font-weight:bold">Get</span>(ctx, <span style="color:#000;font-weight:bold">nil</span>); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>                workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx).<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#d14">&#34;Failed to report metrics&#34;</span>, 
</span></span><span style="display:flex;"><span>                    <span style="color:#d14">&#34;error&#34;</span>, err)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">case</span> <span style="color:#000;font-weight:bold">&lt;-</span>ctx.<span style="color:#900;font-weight:bold">Done</span>():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> ctx.<span style="color:#900;font-weight:bold">Err</span>()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="2">
<li><strong>Graceful Degradation is Better Than Failure</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">processWithDegradation</span>(ctx workflow.Context, 
</span></span><span style="display:flex;"><span>    data []Record) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Try full processing first
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> p.<span style="color:#900;font-weight:bold">processNormally</span>(ctx, data); err <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Fall back to minimal processing if full processing fails
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx).<span style="color:#900;font-weight:bold">Info</span>(<span style="color:#d14">&#34;Falling back to minimal processing&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> p.<span style="color:#900;font-weight:bold">processMinimal</span>(ctx, data)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="3">
<li><strong>Always Have a Rollback Plan</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">safeProcess</span>(ctx workflow.Context, 
</span></span><span style="display:flex;"><span>    batch []Record) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Save state before processing
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    snapshot, err <span style="color:#000;font-weight:bold">:=</span> p.<span style="color:#900;font-weight:bold">createSnapshot</span>(ctx, batch)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;failed to create snapshot: %w&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Process with rollback capability
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> p.<span style="color:#900;font-weight:bold">process</span>(ctx, batch); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        workflow.<span style="color:#900;font-weight:bold">GetLogger</span>(ctx).<span style="color:#900;font-weight:bold">Error</span>(<span style="color:#d14">&#34;Processing failed, rolling back&#34;</span>, 
</span></span><span style="display:flex;"><span>            <span style="color:#d14">&#34;error&#34;</span>, err)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> p.<span style="color:#900;font-weight:bold">rollback</span>(ctx, snapshot)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="performance-tweaks-that-actually-matter">Performance Tweaks That Actually Matter</h3>
<p>Here&rsquo;s what actually moved the needle in production:</p>
<ol>
<li><strong>Batch Size Optimization</strong>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (p <span style="color:#000;font-weight:bold">*</span>Pipeline) <span style="color:#900;font-weight:bold">optimizeBatchSize</span>(ctx workflow.Context, 
</span></span><span style="display:flex;"><span>    initialSize <span style="color:#458;font-weight:bold">int</span>) <span style="color:#458;font-weight:bold">int</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Dynamic batch size based on system performance
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    metrics <span style="color:#000;font-weight:bold">:=</span> p.<span style="color:#900;font-weight:bold">getSystemMetrics</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> metrics.MemoryPressure &gt; <span style="color:#099">80</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> initialSize <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> metrics.ProcessingLatency &lt; time.Second {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">min</span>(initialSize<span style="color:#000;font-weight:bold">*</span><span style="color:#099">2</span>, p.Config.MaxBatchSize)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> initialSize
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="the-future-is-bright-and-possibly-concurrent">The Future is Bright (And Possibly Concurrent)</h2>
<p>Like the post-credits scene in a Marvel movie, let&rsquo;s peek at what&rsquo;s coming next in the world of ETL. But unlike those scenes, I promise this will make immediate sense.</p>
<h3 id="modern-etl-architecture-patterns">Modern ETL Architecture Patterns</h3>
<p>The future of ETL is starting to look more like a streaming service than a batch process. Here&rsquo;s how we&rsquo;re adapting our architecture:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// The future is stream-first, batch-when-needed
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">type</span> StreamingETL <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    Config StreamConfig
</span></span><span style="display:flex;"><span>    Processor <span style="color:#000;font-weight:bold">*</span>Pipeline
</span></span><span style="display:flex;"><span>    Stream stream.Client
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> (s <span style="color:#000;font-weight:bold">*</span>StreamingETL) <span style="color:#900;font-weight:bold">ProcessStreamWithFailover</span>(ctx context.Context) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Set up stream processing with batch fallback
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    streamCtx, cancel <span style="color:#000;font-weight:bold">:=</span> context.<span style="color:#900;font-weight:bold">WithCancel</span>(ctx)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">defer</span> <span style="color:#900;font-weight:bold">cancel</span>()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// Handle both streaming and batch processing
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> workflow.<span style="color:#900;font-weight:bold">ExecuteActivity</span>(streamCtx, <span style="color:#000;font-weight:bold">func</span>(ctx context.Context) <span style="color:#458;font-weight:bold">error</span> {
</span></span><span style="display:flex;"><span>        stream <span style="color:#000;font-weight:bold">:=</span> s.Stream.<span style="color:#900;font-weight:bold">Subscribe</span>(ctx, s.Config.Topic)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Process messages as they arrive
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">select</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">case</span> msg <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">&lt;-</span>stream.<span style="color:#900;font-weight:bold">Messages</span>():
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> err <span style="color:#000;font-weight:bold">:=</span> s.<span style="color:#900;font-weight:bold">processMessage</span>(ctx, msg); err <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">// If streaming fails, fall back to batch processing
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">if</span> errors.<span style="color:#900;font-weight:bold">Is</span>(err, ErrStreamOverload) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">return</span> s.<span style="color:#900;font-weight:bold">fallbackToBatch</span>(ctx, msg)
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">return</span> err
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">case</span> <span style="color:#000;font-weight:bold">&lt;-</span>ctx.<span style="color:#900;font-weight:bold">Done</span>():
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span> ctx.<span style="color:#900;font-weight:bold">Err</span>()
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }).<span style="color:#900;font-weight:bold">Get</span>(streamCtx, <span style="color:#000;font-weight:bold">nil</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="when-to-use-this-stack-and-when-not-to">When to Use This Stack (And When Not To)</h3>
<p>Like choosing between Iron Man&rsquo;s suits, picking the right tool for the job is crucial:</p>
<p><strong>Use This Stack When:</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ShouldUseThisStack</span>(requirements Requirements) <span style="color:#458;font-weight:bold">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> requirements.NeedsReliability <span style="color:#000;font-weight:bold">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        requirements.HasComplexWorkflows <span style="color:#000;font-weight:bold">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        requirements.RequiresScaling <span style="color:#000;font-weight:bold">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        requirements.NeedsVisibility <span style="color:#000;font-weight:bold">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        !requirements.IsSimpleCronJob <span style="color:#998;font-style:italic">// Don&#39;t over-engineer!
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span></code></pre></div><p><strong>Consider Alternatives When:</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ConsiderAlternatives</span>(requirements Requirements) <span style="color:#458;font-weight:bold">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> requirements.IsSimpleDataCopy <span style="color:#000;font-weight:bold">||</span>
</span></span><span style="display:flex;"><span>        requirements.IsSingleThreadedOnly <span style="color:#000;font-weight:bold">||</span>
</span></span><span style="display:flex;"><span>        requirements.HasNoRetryRequirements <span style="color:#000;font-weight:bold">||</span>
</span></span><span style="display:flex;"><span>        requirements.BudgetIsTight <span style="color:#000;font-weight:bold">&amp;&amp;</span> requirements.ScaleIsSmall
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="next-steps-for-your-etl-journey">Next Steps for Your ETL Journey</h3>
<p>Here&rsquo;s a practical roadmap for implementing your own reliable ETL system:</p>
<ol>
<li><strong>Start Small But Think Big</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">type</span> ETLImplementationPhase <span style="color:#000;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>    Phase       <span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>    Description <span style="color:#458;font-weight:bold">string</span>
</span></span><span style="display:flex;"><span>    Tasks       []Task
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">var</span> implementationRoadmap = []ETLImplementationPhase{
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Phase: <span style="color:#099">1</span>,
</span></span><span style="display:flex;"><span>        Description: <span style="color:#d14">&#34;Basic Pipeline Setup&#34;</span>,
</span></span><span style="display:flex;"><span>        Tasks: []Task{
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Set up basic Go project structure&#34;</span>},
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Implement simple Temporal workflow&#34;</span>},
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Add basic monitoring&#34;</span>},
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Phase: <span style="color:#099">2</span>,
</span></span><span style="display:flex;"><span>        Description: <span style="color:#d14">&#34;Add Reliability Features&#34;</span>,
</span></span><span style="display:flex;"><span>        Tasks: []Task{
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Implement retry logic&#34;</span>},
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Add error handling&#34;</span>},
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Set up monitoring dashboards&#34;</span>},
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Phase: <span style="color:#099">3</span>,
</span></span><span style="display:flex;"><span>        Description: <span style="color:#d14">&#34;Scale Up&#34;</span>,
</span></span><span style="display:flex;"><span>        Tasks: []Task{
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Add concurrent processing&#34;</span>},
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Implement batch processing&#34;</span>},
</span></span><span style="display:flex;"><span>            {Name: <span style="color:#d14">&#34;Set up performance monitoring&#34;</span>},
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Building reliable ETL systems is like assembling the Avengers ‚Äì it takes time, patience, and a lot of trial and error. But with Go and Temporal as your core team members, you&rsquo;re well-equipped to handle whatever data challenges come your way.</p>
<p>Key takeaways:</p>
<ol>
<li><strong>Reliability First</strong>: Like Captain America&rsquo;s shield, your ETL system should be dependable above all else.</li>
<li><strong>Visibility is Crucial</strong>: Like Doctor Strange&rsquo;s all-seeing eye, you need to know what&rsquo;s happening at all times.</li>
<li><strong>Scale Smartly</strong>: Like Ant-Man, your system should grow and shrink based on need.</li>
<li><strong>Handle Failures Gracefully</strong>: Like Thor getting back up after being knocked down, your system should recover elegantly from failures.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">FinalThoughts</span>() <span style="color:#458;font-weight:bold">string</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">`
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        ETL might not save the universe, but it keeps our data 
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        flowing and our systems running. And in today&#39;s 
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        data-driven world, that&#39;s pretty close to being a superhero.
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        Now go forth and build something awesome!
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    `</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now, if you&rsquo;ll excuse me, I have a data pipeline to monitor. ü¶∏‚Äç‚ôÇÔ∏è</p>


<div class="mt-6 py-6 border-gray-200 border-t flex justify-between">
    
    <a href="/microservices/legacy-systems-to-microservices/" class="pr-4">&larr; Your Legacy System is Trying to Tell You Something (And It&#39;s Not &#39;Please Reboot&#39;)</a>
    
        
</div>



    </article>
    </div>
    <footer class="container mx-auto pl-5 pt-3 pb-5 mt-32 border-t border-gray-400">
        <div class="text-xs text-gray-700 float-right h-24">
            &copy; 2025 Prasanth Janardhanan
        </div>
    </footer>
</body>
</html>

